(function(){const u="roster",K=["Infantry","Armored","Flying","Cavalry"],_=["Red Sword","Blue Lance","Green Axe","Colorless Staff"],m=document.getElementById("barracks"),j=document.querySelectorAll('input[name="tab"]'),g=document.getElementById("search-content"),b=document.getElementById("search-query"),B=document.getElementById("skill-donors"),F=document.getElementById("skill-filters"),x=document.getElementById("export"),U=document.getElementById("import"),E="https://api.feh-inheritance.tonion-the-onion.com";let v,y="",C=0,l="";document.getElementById("search").click(),x.onclick=q,U.onchange=J,Array.from(document.getElementsByClassName("filter-input")).forEach(e=>{e.onclick=function(){l=this.id,$(l,v)}});for(let e of j)e.onchange=function(){const{id:t}=this,a=document.querySelectorAll(".tab-content");for(let o of a)o.id.includes(t)?o.classList.remove("hide"):o.classList.add("hide");t==="inheritables"?b.parentNode.classList.add("hide"):b.parentNode.classList.remove("hide")};b.onkeyup=e=>{y=e.target.value,(y.length>2||!y.length)&&(C=0,S(0))};for(let e of["Red","Blue","Green","Colorless"])for(let t of["Bow","Tome","Breath","Beast","Dagger"])_.push(`${e} ${t}`);localStorage.getItem(u)?D():localStorage.setItem(u,"[]"),S(C);function D(){const e=JSON.parse(localStorage.getItem(u));if(e.length){for(let t of e)if(t){const{heroButton:a,iconsContainer:o}=k(t.id,!0),c=A(),r=N(t.favorite);a.dataset.favorite=t.favorite,c.onclick=O(t.id,a),r.onclick=R(a,t.favorite),o.appendChild(c),o.appendChild(r),a.onclick=function(){v=this,l||(l="weapon",document.getElementById(l).checked=!0),$(l,this)},m.appendChild(a)}}}function O(e,t){return function(o){o.stopPropagation();const{heroButton:c}=k(e);g.prepend(c),m.removeChild(t),c.onclick=H,I()}}function R(e,t){let a=t;return function(c){const r=!a;if(this.src=r?"./static/favorite-on.png":"./static/favorite-off.png",e.dataset.favorite=r.toString(),c.stopPropagation(),r){const i=JSON.parse(localStorage.getItem(u)).find(s=>!s.favorite);if(i){const{id:s}=i;e.parentNode.insertBefore(e,e.parentNode.querySelector(`[data-unit-id="${s}"]`))}}I(),a=r,v=e,document.getElementById("weapon").click()}}function I(){const e=m.getElementsByClassName("hero-container"),t=Array.prototype.map.call(e,a=>({id:a.dataset.unitId,favorite:a.dataset.favorite!="false"}));localStorage.setItem(u,JSON.stringify(t))}function H(){const e=A(),t=N(!1);t.onclick=R(newButtons.heroButton,!1),e.onclick=O(this.dataset.unitId,newButtons.heroButton),newButtons.iconsContainer.appendChild(e),newButtons.iconsContainer.appendChild(t),m.appendChild(newButtons.heroButton),newButtons.heroButton.dataset.favorite=!1,newButtons.heroButton.onclick=function(){v=this,l||(l="weapon",document.getElementById(l).checked=!0),$(l,this)},I(),g.removeChild(this)}function S(e,t){const a=JSON.parse(localStorage.getItem(u)),o=new URLSearchParams;for(let{id:r}of a)o.append("ids",r);y.trim().length&&o.append("query",y),o.append("page",e);const c=new AbortController;return fetch(`${E}/heroes?${o.toString()}`,{signal:c.signal}).catch(()=>{}).then(r=>r.json()).then(r=>{t||(g.innerHTML="");for(let i of r){const{wpn:s,mvt:d,id:L,name:h}=i,{heroButton:p,iconsContainer:f}=k(L,!0,h);g.appendChild(p),p.onclick=H}let n=document.getElementById("load-more");if(!n){const i=document.createElement("button");i.classList.add("cta"),i.id="load-more",i.onclick=function(){C++,S(C,!0)},i.innerHTML="Load More",n=i}g.appendChild(n)})}function k(e,t,a){const o=document.createElement("button");o.classList.add("hero-container");const c=document.createElement("img");c.alt=a??"",c.src="./static/frame.webp",c.classList.add("hero-frame");const r=document.createElement("img");r.loading="lazy",r.src=`${E}/img?id=${e}&imgType=portrait`,r.classList.add("portrait"),o.appendChild(r),o.dataset.unitId=e;let n=null;return n=document.createElement("div"),n.classList.add("icons-container"),n.appendChild(c),t?o.appendChild(n):o.appendChild(c),{heroButton:o,iconsContainer:n}}function A(){const e=document.createElement("div");e.classList.add("delete-button");const t=document.createElement("img");return t.src="./static/trash.png",e.appendChild(t),e}function N(e){const t=document.createElement("img");return t.src=e?"./static/favorite-on.png":"./static/favorite-off.png",t.classList.add("top-left"),t}function $(e,t){const{unitId:a}=t.dataset,r=JSON.parse(localStorage.getItem(u)).filter(({favorite:n})=>!n).map(({id:n})=>(+n).toString(16));document.getElementById("inheritables").click(),fetch(`${E}/skills?slot=${e}&searchedId=${a}&mode=roster&ids=${r.join(",")}`).then(n=>n.json()).then(n=>{B.innerHTML="";const i=document.getElementById("upgrade-heading");F.classList.remove("hide"),i.innerHTML=`Skills that ${n.searched} can inherit`,i.classList.add("target-banner");let s=document.getElementById("target-portrait");if(s||(s=document.createElement("img"),s.id="target-portrait",s.loading="lazy",i.appendChild(s)),s.alt="",s.src=`${E}/img?id=${a}&imgType=battle`,!Object.keys(n.Skills).length){const d=document.createElement("div");d.classList.add("donor-banner"),d.innerHTML=`There are no units that could give any ${e} in the current roster.`,B.appendChild(d);return}for(let d in n.Skills){const L=n.Skills[d],h=document.createElement("h3");h.classList.add("skill-subtitle"),h.innerHTML=d;const p=document.createElement("div");p.classList.add("skill-title");const f=document.createElement("img");f.classList.add("skill-icon"),f.loading="lazy",["weapon","assist","special"].includes(e)?f.src=`./static/${e}-icon.png`:f.src=`https://feheroes.fandom.com/wiki/Special:Filepath/${L.icon}.png`,p.appendChild(f),B.appendChild(h),p.appendChild(h),B.appendChild(p);for(let P of L.ids){const z=n.units[P],w=document.createElement("div");w.classList.add("donor-banner"),w.innerText=z.replace(":",": ");const T=document.createElement("img");T.loading="lazy",T.src=`${E}/img?id=${P}&imgType=battle`,T.classList.add("skill-donor"),w.appendChild(T),B.appendChild(w)}}})}function J(){const[e]=this.files,t=new FileReader;t.onerror=function(){alert("An error happened, please try again.")},t.onloadend=({target:a})=>{const{result:o}=a;try{const c=JSON.parse(o);if(c.find(n=>typeof n!="object"||!n.id||!("favorite"in n)))throw new Error;m.innerHTML="";for(let n of c){const i=k(n.id,!0),s=N(n.favorite),d=A();i.heroButton.dataset.favorite=n.favorite,i.iconsContainer.appendChild(s),i.iconsContainer.appendChild(d),s.onclick=R(i.heroButton,!1),d.onclick=O(i.heroButton.dataset.unitId,i.heroButton),m.appendChild(i.heroButton)}I(),S(0)}catch{alert("There was an error parsing your file. Please try with another one.")}},t.readAsText(e)}function q(){const e=JSON.stringify(JSON.parse(localStorage.getItem(u))),t=document.createElement("a");t.style.display="none",document.body.appendChild(t),t.download="feh-roster.json";const a=new Blob([e],{type:"text/json"}),o=URL.createObjectURL(a);t.href=o,t.click(),document.body.removeChild(t)}function M(){const e=window.innerHeight*.01;document.documentElement.style.setProperty("--vh",`${e}px`)}window.addEventListener("load",M),window.addEventListener("resize",M)})();
