(function(){const u="roster",K=["Infantry","Armored","Flying","Cavalry"],_=["Red Sword","Blue Lance","Green Axe","Colorless Staff"],p=document.getElementById("barracks"),j=document.querySelectorAll('input[name="tab"]'),f=document.getElementById("search-content"),b=document.getElementById("search-query"),g=document.getElementById("skill-donors"),F=document.getElementById("skill-filters"),x=document.getElementById("export"),U=document.getElementById("import"),E="https://api.feh-inheritance.tonion-the-onion.com";let I,y="",C=0,d="";document.getElementById("search").click(),x.onclick=q,U.onchange=J,Array.from(document.getElementsByClassName("filter-input")).forEach(e=>{e.onclick=function(){d=this.id,$(d,I)}});for(let e of j)e.onchange=function(){const{id:t}=this,n=document.querySelectorAll(".tab-content");for(let o of n)o.id.includes(t)?o.classList.remove("hide"):o.classList.add("hide");t==="inheritables"?b.parentNode.classList.add("hide"):b.parentNode.classList.remove("hide")};b.onkeyup=e=>{y=e.target.value,(y.length>2||!y.length)&&(C=0,k(0))};for(let e of["Red","Blue","Green","Colorless"])for(let t of["Bow","Tome","Breath","Beast","Dagger"])_.push(`${e} ${t}`);localStorage.getItem(u)?D():localStorage.setItem(u,"[]"),k(C);function D(){const e=JSON.parse(localStorage.getItem(u));if(e.length){for(let t of e)if(t){const{heroButton:n,iconsContainer:o}=B(t.id,!0),c=A(),i=N(t.favorite);n.dataset.favorite=t.favorite,c.onclick=O(t.id,n),i.onclick=R(n,t.favorite),o.appendChild(c),o.appendChild(i),n.onclick=function(){I=this,d||(d="weapon",document.getElementById(d).checked=!0),$(d,this)},p.appendChild(n)}}}function O(e,t){return function(o){o.stopPropagation();const{heroButton:c}=B(e);f.prepend(c),p.removeChild(t),c.onclick=H,S()}}function R(e,t){let n=t;return function(c){const i=!n;if(this.src=i?"./static/favorite-on.png":"./static/favorite-off.png",e.dataset.favorite=i.toString(),c.stopPropagation(),i){const r=JSON.parse(localStorage.getItem(u)).find(s=>!s.favorite);if(r){const{id:s}=r;e.parentNode.insertBefore(e,e.parentNode.querySelector(`[data-unit-id="${s}"]`))}}S(),n=i,I=e,document.getElementById("weapon").click()}}function S(){const e=p.getElementsByClassName("hero-container"),t=Array.prototype.map.call(e,n=>({id:n.dataset.unitId,favorite:n.dataset.favorite!="false"}));localStorage.setItem(u,JSON.stringify(t))}function H(){const e=B(this.dataset.unitId,!0),t=A(),n=N(!1);n.onclick=R(e.heroButton,!1),t.onclick=O(this.dataset.unitId,e.heroButton),e.iconsContainer.appendChild(t),e.iconsContainer.appendChild(n),p.appendChild(e.heroButton),e.heroButton.dataset.favorite=!1,e.heroButton.onclick=function(){I=this,d||(d="weapon",document.getElementById(d).checked=!0),$(d,this)},S(),f.removeChild(this)}function k(e,t){const n=JSON.parse(localStorage.getItem(u)),o=new URLSearchParams;for(let{id:i}of n)o.append("ids",i);y.trim().length&&o.append("query",y),o.append("page",e);const c=new AbortController;return fetch(`${E}/heroes?${o.toString()}`,{signal:c.signal}).catch(()=>{}).then(i=>i.json()).then(i=>{t||(f.innerHTML="");for(let r of i){const{wpn:s,mvt:l,id:L,name:v}=r,{heroButton:m,iconsContainer:h}=B(L,!0);f.appendChild(m),m.onclick=H}let a=document.getElementById("load-more");if(!a){const r=document.createElement("button");r.classList.add("cta"),r.id="load-more",r.onclick=function(){C++,k(C,!0)},r.innerHTML="Load More",a=r}f.appendChild(a)})}function B(e,t){const n=document.createElement("button");n.classList.add("hero-container");const o=document.createElement("img");o.src="./static/frame.webp",o.classList.add("hero-frame");const c=document.createElement("img");c.loading="lazy",c.src=`${E}/img?id=${e}&imgType=portrait`,c.classList.add("portrait"),n.appendChild(c),n.dataset.unitId=e;let i=null;return i=document.createElement("div"),i.classList.add("icons-container"),i.appendChild(o),t?n.appendChild(i):n.appendChild(o),{heroButton:n,iconsContainer:i}}function A(){const e=document.createElement("div");e.classList.add("delete-button");const t=document.createElement("img");return t.src="./static/trash.png",e.appendChild(t),e}function N(e){const t=document.createElement("img");return t.src=e?"./static/favorite-on.png":"./static/favorite-off.png",t.classList.add("favorite-button"),t}function $(e,t){const{unitId:n}=t.dataset,i=JSON.parse(localStorage.getItem(u)).filter(({favorite:a})=>!a).map(({id:a})=>(+a).toString(16));document.getElementById("inheritables").click(),fetch(`${E}/skills?slot=${e}&searchedId=${n}&mode=roster&ids=${i.join(",")}`).then(a=>a.json()).then(a=>{g.innerHTML="";const r=document.getElementById("upgrade-heading");F.classList.remove("hide"),r.innerHTML=`Skills that ${a.searched} can inherit`,r.classList.add("target-banner");let s=document.getElementById("target-portrait");if(s||(s=document.createElement("img"),s.id="target-portrait",s.loading="lazy",r.appendChild(s)),s.src=`${E}/img?id=${n}&imgType=battle`,!Object.keys(a.Skills).length){const l=document.createElement("div");l.classList.add("donor-banner"),l.innerHTML=`There are no units that could give any ${e} in the current roster.`,g.appendChild(l);return}for(let l in a.Skills){const L=a.Skills[l],v=document.createElement("h3");v.classList.add("skill-subtitle"),v.innerHTML=l;const m=document.createElement("div");m.classList.add("skill-title");const h=document.createElement("img");h.classList.add("skill-icon"),h.loading="lazy",["weapon","assist","special"].includes(e)?h.src=`./static/${e}-icon.png`:h.src=`https://feheroes.fandom.com/wiki/Special:Filepath/${L.icon}.png`,m.appendChild(h),g.appendChild(v),m.appendChild(v),g.appendChild(m);for(let P of L.ids){const z=a.units[P],T=document.createElement("div");T.classList.add("donor-banner"),T.innerText=z.replace(":",": ");const w=document.createElement("img");w.loading="lazy",w.src=`${E}/img?id=${P}&imgType=battle`,w.classList.add("skill-donor"),T.appendChild(w),g.appendChild(T)}}})}function J(){const[e]=this.files,t=new FileReader;t.onerror=function(){alert("An error happened, please try again.")},t.onloadend=({target:n})=>{const{result:o}=n;try{const c=JSON.parse(o);if(c.find(a=>typeof a!="object"||!a.id||!("favorite"in a)))throw new Error;p.innerHTML="";for(let a of c){const r=B(a.id,!0),s=N(a.favorite),l=A();r.heroButton.dataset.favorite=a.favorite,r.iconsContainer.appendChild(s),r.iconsContainer.appendChild(l),s.onclick=R(r.heroButton,!1),l.onclick=O(r.heroButton.dataset.unitId,r.heroButton),p.appendChild(r.heroButton)}S(),k(0)}catch{alert("There was an error parsing your file. Please try with another one.")}},t.readAsText(e)}function q(){const e=JSON.stringify(JSON.parse(localStorage.getItem(u))),t=document.createElement("a");t.style.display="none",document.body.appendChild(t),t.download="feh-roster.json";const n=new Blob([e],{type:"text/json"}),o=URL.createObjectURL(n);t.href=o,t.click(),document.body.removeChild(t)}function M(){const e=window.innerHeight*.01;document.documentElement.style.setProperty("--vh",`${e}px`)}window.addEventListener("load",M),window.addEventListener("resize",M)})();
